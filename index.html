<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <link rel="icon" href="/favicon.ico" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Zoe Workspace</title>
  <script src="https://unpkg.com/@seregpie/save-file"></script>
</head>
<body>
  <h3>async await</h3>
  <form action="">
    <input type="file" name="old" accept="html" id="htmlFile">
    <input type="text" name="new" />
    <button type="button" onclick="save">Save</button>
  </form>
  
  <p id="htos"></p>
<script>
import saveFile from 'save-file'
var saveFile = require('save-file')
const content = document.querySelector('#htos');
var new_content ='';
const selectElement = document.querySelector('input[name="new"]');

function readSingleFile(evt) {
  //Retrieve the first (and only!) File from the FileList object
  let f = evt.target.files[0]; 
  if (f) {
    let r = new FileReader();
    r.onload = function(e) { 
      let contents = e.target.result;
      alert(contents);
      new_content = contents.replace(/<title>(.*?)<\/title>/g,"<title></title>")
      content.innerText = new_content
    }
    r.readAsText(f);
  } else { 
    alert("Failed to load file");
  }
}

async function save() {
    alert(new_content);
    let file_name = selectElement.value + '.html'
    let file = new Blob([new_content], {type: 'text/html'});
    await saveFile(file, file_name);
}
document.getElementById('htmlFile').addEventListener('change', readSingleFile, false);
</script>
</body>
</html>
